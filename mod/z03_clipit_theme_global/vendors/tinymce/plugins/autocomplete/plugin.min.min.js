var c=null,i=!1;function j(a){return a.options==c&&"boolean"!=typeof a?a.split(","):a.options}var p={},v=[32,59,186,188,190];tinymce.create("tinymce.plugins.AutoCompletePlugin",{Y:function(a){p.options=j(a)},L:function(){return p.options},P:function(o){function y(h,l){var s=matches,r="",q=RegExp("("+h+")"),n;for(n in s){r=s[n].key!=c?r+("<li data-value='"+s[n].key+"'>"+s[n].key.replace(q,"<mark>$1</mark>")+" "+s[n].description+"</li>"):r+("<li data-value='"+s[n]+"'>"+s[n].replace(q,"<mark>$1</mark>")+"</li>")}jQuery(p.list).N(r);var s=jQuery(l.t()).position(),r=jQuery(l.t()).find(".mceToolbar").J(),q=jQuery(l.selection.u()).position(),m=n=0;0<l.selection.h().getClientRects().length?(n=l.selection.h().getClientRects()[0].top+l.selection.h().getClientRects()[0].height,m=l.selection.h().getClientRects()[0].left):(n=1.3*parseInt(jQuery(l.selection.u()).f("font-size"))+q.top,m=q.left);jQuery(p.list).f("margin-top",s.top+r.innerHeight()+n);jQuery(p.list).f("margin-left",s.left+m);jQuery(p.list).f("display","block");p.visible=!0;jQuery(p.list).find("li").M(function(){jQuery(p.list).find("[data-selected=true]").a("data-selected","false");jQuery(this).a("data-selected","true")});jQuery(p.list).find("li").click(function(){x(l,e(l))})}function g(){jQuery(p.list).f("display","none");p.visible=i}function b(){var f=jQuery(p.list).find("[data-selected=true]");0==f.size()||0==f.next().size()?jQuery(p.list).find("li:first-child").a("data-selected","true"):f.next().a("data-selected","true");f.a("data-selected","false")}function x(h,l){var s=jQuery(p.list).find("[data-selected=true]").a("data-value");s==c&&(s=jQuery(p.list).find("li:first-child").a("data-value"));var r=w(h.selection.i().anchorNode,""),q=h.selection.i().anchorNode.textContent,n=h.selection.h();n.setStart(n.startContainer,n.startOffset-l.length);h.selection.Z(n);n="";0<p.m.length&&(n=String.fromCharCode(p.m[0]));h.selection.z(p.c+s.toString()+n);var m;if(m=0<p.g.length){m=p.c+p.g,r=r.substr(q.length),r=RegExp(p.c+".{"+p.g.length+"}","g").exec(r),m=!(r!=c&&0<r.length&&r[0]==m)}m&&(r=h.selection.getBookmark(),h.selection.z(n+p.c+p.g),h.selection.moveToBookmark(r));g();p.e&&k.e.r(h,s);g()}function w(f,h){h+=f.textContent;return f.nextSibling!=c?w(f.nextSibling,h):h}function d(f){var h=p.options,m=[],l;for(l in h){h[l].key==c&&(0==f.length||h[l].match(RegExp("^"+f,"i")))?m.push(h[l]):h[l].key!=c&&(0==f.length||h[l].key.match(RegExp("^"+f,"i")))&&m.push(h[l])}return m}function e(f){var h=f.selection.i().focusNode==c?"":f.selection.i().focusNode.nodeValue,f=f.selection.i().focusOffset;if(h==c||0==h.length){return""}for(var m=0,l=0;l<f;l++){-1!=p.m.indexOf(h.charCodeAt(l).toString())&&(m=l+1)}h=h.substr(m,f-m);f="";""==p.c?h.length>=p.v&&(f=h):0<h.length&&h.charAt(0).toString()==p.c&&(f=h);return f}var a=document.createElement("ul");jQuery(a).D("auto-list");document.body.appendChild(a);p={list:a,visible:i,l:i,m:o.b("autocomplete_delimiters","160,32").split(","),options:j(o.b("autocomplete_options","")),p:j(o.b("autocomplete_options_url",i)),c:o.b("autocomplete_trigger","@"),g:o.b("autocomplete_end_option",""),v:o.b("autocomplete_min_length","3"),e:o.b("autocomplete_on_select",i),d:o.b("autocomplete_on_match",i)};var k=this;p.e&&(k.e=new tinymce.A.q(k),k.e.add(function(f,h){f.s("autocomplete_on_select",f,h)}));p.d&&(k.d=new tinymce.A.q(k),k.d.add(function(f,h){f.s("autocomplete_on_match",f,h)}));o.X.o(function(f,l){if(!p.visible&&27!=l.keyCode&&13!=l.keyCode||40!=l.keyCode&&38!=l.keyCode&&13!=l.keyCode&&27!=l.keyCode){var q=e(f),n=d(q);if(0<q.length){var m=q.replace(p.c,"");p.p?1>=m.length||jQuery.F({type:"GET",url:p.p,I:i,data:"q="+m,$:function(r){if(r.T&&r.j){var h=[],s;for(s in r.j){r.j[s].name&&h.push(r.j[s].name)}p.options=h;matches=d(m);0<matches.length&&(y(m,o),b())}},error:function(){}}):(matches=d(m),0<matches.length&&(y(m,o),b()))}(0==q.length||0==n.length)&&g()}});o.V.o(function(h,l){if(p.visible){if(40==l.keyCode){return b(),tinymce.n.k.cancel(l)}if(38==l.keyCode){var q=jQuery(p.list).find("[data-selected=true]");0==q.size()||0==q.w().size()?jQuery(p.list).find("li:last-child").a("data-selected","true"):q.w().a("data-selected","true");q.a("data-selected","false");return tinymce.n.k.cancel(l)}if(13==l.keyCode){return x(h,e(h)),p.l=!0,i}if(27==l.keyCode){return g(),tinymce.n.k.cancel(l)}if(p.d&&v.indexOf(l.keyCode)){var q=e(h),n=d(q),m=RegExp("^"+n[0]+"$","i");1==n.length&&q.match(m)&&k.d.r(h,n[0])}}});o.W.o(function(f,h){if(13==h.keyCode&&p.l){return p.l=i,tinymce.n.k.cancel(h)}});o.U.add(function(){g()})},K:function(){return{Q:"AutoComplete",G:"Mijura Pty Ltd",H:"http://mijura.com",O:"http://blog.mijura.com",version:tinymce.R+"."+tinymce.S}}});tinymce.C.add("autocomplete",tinymce.plugins.B);